# New Features Documentation

This document describes the three new features added to the English Learning App.

## 1. Gemini API Integration for Word Lookup

### Overview
The Dictionary API has been completely replaced with Google's Gemini AI API for enhanced word lookup functionality.

### Features
- **Standard Word Lookup**: Get meaning, pronunciation (IPA), example sentences, and synonyms
- **Level-Based Lookup**: Request definitions appropriate for CEFR levels (A1-C2)
- **Contextual Understanding**: Gemini provides more natural and contextual definitions

### Implementation Details

#### API Service
Location: `app/src/main/java/com/example/englishapp/data/remote/GeminiWordLookupService.kt`

Key methods:
```kotlin
suspend fun lookupWord(word: String): Result<GeminiWordResponse>
suspend fun lookupWordWithLevel(word: String, level: String): Result<GeminiWordResponse>
```

#### Response Format
```json
{
  "word": "example",
  "meaning": "a thing characteristic of its kind...",
  "example": "This painting is a fine example of the artist's work",
  "synonyms": ["sample", "specimen", "instance"],
  "phonetic": "/…™…°Ààz…ëÀêmp(…ô)l/"
}
```

#### Configuration
**IMPORTANT**: Before using, you must set your Gemini API key:

1. Open `app/src/main/java/com/example/englishapp/util/Constants.kt`
2. Replace `YOUR_GEMINI_API_KEY_HERE` with your actual API key
3. Get your API key from: https://makersuite.google.com/app/apikey

Alternative: Use BuildConfig or local.properties for secure key storage.

### Usage
The Search screen automatically uses Gemini API when looking up words. No UI changes required.

---

## 2. Auto-Generated Flashcard Decks

### Overview
Automatically create flashcard decks from your vocabulary based on learning status.

### Features
- **Unknown Words Deck**: Auto-generate from words marked as NEW
- **Learning Words Deck**: Auto-generate from words you're currently learning
- **Known Words Deck**: Auto-generate from mastered vocabulary
- **Review All Deck**: Create a comprehensive deck with all vocabulary

### Implementation Details

#### Repository Methods
Location: `app/src/main/java/com/example/englishapp/data/repository/FlashcardRepository.kt`

Key methods:
```kotlin
suspend fun autoGenerateDeckByStatus(status: LearningStatus): Long
suspend fun autoGenerateReviewAllDeck(): Long
suspend fun autoGenerateDeckFromVocab(vocabList: List<Vocabulary>, deckName: String, description: String?): Long
```

#### Database Schema
The existing `VocabEntity` already tracks learning status:
- `NEW`: Newly added words
- `LEARNING`: Words being studied
- `MASTERED`: Words you've mastered

### Usage

1. Navigate to the Flashcards tab
2. Tap the sparkle icon (‚ú®) in the top-right corner
3. Choose your deck type:
   - üÜï Unknown Words (NEW)
   - üìñ Learning Words
   - ‚úÖ Known Words (MASTERED)
   - üîÑ Review All Words
4. The deck will be automatically created with all matching vocabulary

### Flashcard Format
Each auto-generated card contains:
- **Front**: Word
- **Back**: Meaning
- **Additional**: Example sentence and pronunciation (if available)

---

## 3. Pronunciation Practice with AI Scoring

### Overview
Practice English pronunciation with real-time speech recognition and AI-powered scoring.

### Features
- **Sample Sentences**: Practice with curated English sentences
- **Text-to-Speech**: Hear correct pronunciation
- **Speech Recognition**: Record your pronunciation
- **AI Scoring**: Get scored 0-100 with detailed feedback
- **Mistake Detection**: Identify specific pronunciation errors
- **Improvement Tips**: Receive personalized feedback

### Implementation Details

#### Components

**PronunciationScreen**
Location: `app/src/main/java/com/example/englishapp/ui/screens/pronunciation/PronunciationScreen.kt`

UI Elements:
- Large sample sentence display (22sp)
- Speaker icon for TTS playback
- Round microphone button with 3 states:
  - IDLE (blue): Ready to record
  - LISTENING (red): Currently recording
  - PROCESSING (amber): Processing speech
- User speech result display
- Score button
- Results card with score, similarity, mistakes, and feedback

**Scoring Service**
Location: `app/src/main/java/com/example/englishapp/data/remote/PronunciationScoringService.kt`

Uses Gemini AI to:
- Compare expected vs. actual text
- Calculate similarity score (0-100)
- Identify pronunciation mistakes
- Generate improvement feedback

#### Scoring Criteria
- **90-100**: Excellent pronunciation, all words correct
- **75-89**: Good pronunciation, minor mistakes
- **60-74**: Fair pronunciation, several mistakes
- **40-59**: Needs improvement, many mistakes
- **0-39**: Poor pronunciation, major issues

#### Response Format
```json
{
  "score": 85,
  "similarity": "High",
  "mistakes": ["Missing word: 'the'", "Wrong pronunciation: 'quick' ‚Üí 'quik'"],
  "feedback": "Great job! Focus on pronouncing 'quick' with the full 'ck' sound. Practice the article 'the' more slowly."
}
```

### Usage

1. Navigate to Home screen
2. Tap "üé§ Luy·ªán ph√°t √¢m" (Pronunciation Practice)
3. Read the sample sentence
4. Tap the speaker icon to hear correct pronunciation
5. Tap the microphone button to record yourself
6. Speak clearly and tap stop when done
7. Tap "Score My Pronunciation"
8. Review your score and feedback
9. Tap "Try Again" for a new sentence

### Permissions
The app requires microphone permission for speech recognition:
```xml
<uses-permission android:name="android.permission.RECORD_AUDIO" />
```

This permission is requested at runtime when you first tap the microphone button.

---

## Technical Architecture

### Data Flow

#### Word Lookup (Gemini)
```
SearchScreen ‚Üí SearchViewModel ‚Üí VocabRepository ‚Üí GeminiWordLookupService ‚Üí Gemini API
                                                                              ‚Üì
                                                    Vocabulary ‚Üê GeminiWordResponse
```

#### Auto-Generated Flashcards
```
FlashcardDeckListScreen ‚Üí FlashcardViewModel ‚Üí FlashcardRepository ‚Üí VocabDao
                                                                      ‚Üì
                                                    Auto-create deck with filtered vocabs
```

#### Pronunciation Scoring
```
PronunciationScreen ‚Üí SpeechRecognizer ‚Üí PronunciationViewModel ‚Üí PronunciationRepository
                                                                    ‚Üì
                                         PronunciationScoringService ‚Üí Gemini API
                                                                    ‚Üì
                                                        PronunciationResult
```

### Dependency Injection (Koin)

All new components are registered in `AppModule.kt`:

```kotlin
// Services
single { GeminiWordLookupService(Constants.GEMINI_API_KEY) }
single { PronunciationScoringService(Constants.GEMINI_API_KEY) }

// Repositories
single { PronunciationRepository(get()) }

// ViewModels
viewModel { PronunciationViewModel(get()) }
```

---

## Testing

### Manual Testing

#### Gemini Word Lookup
1. Navigate to Search tab
2. Enter "example" and search
3. Verify response includes: word, meaning, example, synonyms, phonetic

#### Auto-Generated Flashcards
1. Add some vocabulary words (mark some as NEW, LEARNING, MASTERED)
2. Go to Flashcards tab
3. Tap sparkle icon (‚ú®)
4. Select "Unknown Words"
5. Verify deck is created with NEW status words only

#### Pronunciation Practice
1. Go to Pronunciation Practice
2. Grant microphone permission if prompted
3. Tap speaker to hear sample
4. Record yourself saying the sentence
5. Score pronunciation
6. Verify score, mistakes, and feedback are displayed

### Edge Cases Handled
- Empty vocabulary list ‚Üí Shows appropriate message
- No microphone permission ‚Üí Requests permission
- Network errors ‚Üí Displays error message with retry option
- Invalid API responses ‚Üí Graceful error handling

---

## Troubleshooting

### Gemini API Issues

**Problem**: "Empty response from Gemini API"
**Solution**: 
1. Verify API key is set correctly in Constants.kt
2. Check internet connection
3. Ensure API key has proper permissions

**Problem**: JSON parsing errors
**Solution**: Gemini sometimes adds markdown formatting. The service automatically strips ```json``` blocks.

### Speech Recognition Issues

**Problem**: Microphone not working
**Solution**:
1. Check app permissions in device settings
2. Ensure no other app is using microphone
3. Restart the app

**Problem**: Poor recognition accuracy
**Solution**:
1. Speak clearly and at moderate pace
2. Reduce background noise
3. Hold device closer to mouth
4. Ensure device microphone is not blocked

### Flashcard Auto-Generation Issues

**Problem**: No decks created
**Solution**:
1. Verify you have vocabulary in the selected status (NEW/LEARNING/MASTERED)
2. Check database has vocabulary entries
3. Try "Review All" option first

---

## Future Enhancements

### Potential Improvements
1. **Gemini API**
   - Cache responses to reduce API calls
   - Add support for multiple languages
   - Implement advanced contextual definitions

2. **Flashcards**
   - Schedule auto-regeneration of decks
   - Add filters by category, difficulty
   - Export/import deck functionality

3. **Pronunciation**
   - Record pronunciation history
   - Show pronunciation progress over time
   - Add word-by-word pronunciation analysis
   - Support custom sentences
   - Add difficulty levels for sentences

---

## API Costs & Limits

### Gemini API
- Free tier: Available for testing
- Rate limits: Check Google AI Studio for current limits
- Recommendation: Implement caching for frequently searched words

### Speech Recognition
- Uses Android's built-in SpeechRecognizer
- No API costs
- Requires internet connection for best accuracy

---

## Credits

- Google Generative AI (Gemini): Word definitions and pronunciation scoring
- Android Speech Recognition: Voice input
- Android TTS: Text-to-speech playback
- Compose UI: Modern Android UI framework
- Room Database: Local data persistence
- Koin: Dependency injection

---

## License

This feature implementation follows the main application's license terms.
